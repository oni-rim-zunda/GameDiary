(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1466:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>ta});var i=r(5155);r(3548);var a=r(2115),s=r(1184),n=function(e){return e[e.entry=0]="entry",e[e.diary=1]="diary",e[e.diaryList=2]="diaryList",e[e.all=3]="all",e}(n||{});let o=(0,a.createContext)(null),c=e=>{let{children:t}=e,r=(0,a.useRef)(new Set),s=(0,a.useRef)(new Set),n=(0,a.useRef)(new Set),c=(0,a.useCallback)(e=>d(r,e),[]),y=(0,a.useCallback)(e=>d(s,e),[]),l=(0,a.useCallback)(e=>d(n,e),[]),d=(0,a.useCallback)((e,t)=>(e.current.add(t),()=>{e.current.delete(t)}),[]),u=(0,a.useCallback)(()=>{r.current.forEach(e=>e())},[]),g=(0,a.useCallback)(()=>{s.current.forEach(e=>e())},[]),h=(0,a.useCallback)(()=>{n.current.forEach(e=>e())},[]),D=(0,a.useCallback)(()=>{u(),g(),h()},[u,g]),m=(0,a.useMemo)(()=>({entryRefresherRegister:c,settingRefresherRegister:y,diaryRefresherRegister:l,refreshEntry:u,refreshSetting:g,refreshDiary:h,refreshAll:D}),[c,y,D]);return(0,i.jsx)(o.Provider,{value:m,children:t})},y=()=>{let e=(0,a.useContext)(o);if(null===e)throw Error("useRefreshContext must be used within a RefreshProvider");return e},l=(0,a.createContext)(null),d=e=>{let{children:t}=e,[r,n]=(0,a.useState)(),[o,c]=(0,a.useState)(),[d,u]=(0,a.useState)([]),{diaryRefresherRegister:g}=y();return((0,a.useEffect)(()=>{let e=s.kL.resolve("ICurrentDiaryAccessor");n(e),c(s.kL.resolve("ICurrentDiaryEntryAccessor"));let t=()=>{let t=[],r=e.getCurrentDiary().getLastDay();for(;void 0!==r;){let i=e.getCurrentDiary().getEntry(r);t.unshift({day:r,title:i.getTitle()}),r=i.previous}u(t)};return t(),g(t)},[g]),void 0===r||void 0===o)?(0,i.jsx)("div",{children:"Loading..."}):(0,i.jsx)(l.Provider,{value:{diaryEntries:d,addDiaryEntry:(e,t)=>{let r={day:e,title:t};u(e=>[...e,r])},deleteDiaryEntry:e=>{e!==o.getCurrentDiaryEntry().day&&(u(t=>t.filter((t,r)=>0===r||t.day!==e)),r.getCurrentDiary().deleteEntry(e))},updateDiaryEntryTitle:(e,t)=>{u(r=>r.map(r=>r.day===e?{...r,title:t}:r))}},children:t})},u=()=>{let e=(0,a.useContext)(l);if(null===e)throw Error("useDiaryEntriesListContext must be used within a DiaryNameListProvider");return e},g=(0,a.createContext)(null),h=e=>{let{children:t}=e,[r,n]=(0,a.useState)(),[o,c]=(0,a.useState)(),[l,d]=(0,a.useState)(),{refreshEntry:h}=y(),{addDiaryEntry:D,deleteDiaryEntry:m}=u();(0,a.useEffect)(()=>{n(s.kL.resolve("IChangeCurrentDiaryEntry")),c(s.kL.resolve("ICurrentDiaryEntryAccessor")),d(s.kL.resolve("ICurrentDiaryAccessor"))},[]);let f=(0,a.useCallback)((e,t)=>{if(void 0!==r&&void 0!==o&&!1!==e.ctrlKey&&t.home()){if("ArrowRight"===e.key){let e=r.moveToNext();if(h(),!e)return;D(o.getCurrentDiaryEntry().day,o.getCurrentDiaryEntry().getTitle())}if("ArrowLeft"===e.key){let e=o.getCurrentDiaryEntry().day,t=r.moveToPrevious();if(h(),!t)return;m(e)}}},[r,o,h,D,m]),v=(0,a.useCallback)(e=>{void 0!==r&&(r.moveByDate(e),h())},[r,h]),p=(0,a.useCallback)(()=>{if(void 0===r||void 0===l)return;let e=l.getCurrentDiary().getLastDay();r.moveByDate(e),h()},[r,l,h]),S=(0,a.useMemo)(()=>({moveByDate:v,moveToLatest:p,onArrowMoveEntry:f}),[v,p,f]);return void 0===v||void 0===p||void 0===f?(0,i.jsx)("div",{children:"Loading..."}):(0,i.jsx)(g.Provider,{value:S,children:t})},D=()=>{let e=(0,a.useContext)(g);if(null===e)throw Error("useChangeCurrentEntryContext must be used within a ChangeCurrentEntryContext");return e},m=(0,a.createContext)(null),f=e=>{let{children:t}=e,[r,s]=(0,a.useState)(!0);return(0,a.useLayoutEffect)(()=>{s("true"===localStorage.getItem("darkMode"))},[]),(0,a.useLayoutEffect)(()=>{"dark"===localStorage.getItem("theme")&&s(!0)},[]),(0,a.useLayoutEffect)(()=>{r?(document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light"))},[r]),(0,i.jsx)(m.Provider,{value:{isDarkMode:r,setDarkMode:s},children:t})},v=()=>{let e=(0,a.useContext)(m);if(null===e)throw Error("useDarkModeContext must be used within a DarkMeadContextProvider");return e},p=(0,a.createContext)(null),S=e=>{let{children:t}=e,[r,n]=(0,a.useState)([]),[o,c]=(0,a.useState)(),{diaryRefresherRegister:l}=y();(0,a.useEffect)(()=>{let e=s.kL.resolve("IDiaryNameService");c(e);let t=()=>{void 0!==e&&n(e.collectDiaryNameEntries())};return t(),l(t)},[l]),(0,a.useEffect)(()=>{void 0!==o&&n(o.collectDiaryNameEntries())},[o,n]);let d=(0,a.useCallback)(e=>void 0===o?"":o.getDiaryName(e),[o]),u=(0,a.useMemo)(()=>({diaryNames:r,getDiaryName:d}),[r,d]);return void 0===u?(0,i.jsx)("div",{children:"Loading..."}):(0,i.jsx)(p.Provider,{value:u,children:t})},E=()=>{let e=(0,a.useContext)(p);if(null===e)throw Error("useDiaryNameListContext must be used within a DiaryNameListProvider");return e},x=()=>{let[e,t]=(0,a.useState)(""),[r,i]=(0,a.useState)(),[n,o]=(0,a.useState)(),[c,y]=(0,a.useState)(!1),l=(0,a.useCallback)(()=>{void 0!==r&&t(r.getCurrentDiaryEntry().getTitle())},[r]),d=(0,a.useCallback)(e=>{void 0!==n&&void 0!==l&&(n.editTitle(e),l())},[n,l]);return((0,a.useEffect)(()=>{i(s.kL.resolve("ICurrentDiaryEntryAccessor")),o(s.kL.resolve("IEditDiaryEntry")),y(!0),l()},[]),c&&void 0!==d&&void 0!==l)?{isReady:c,title:e,updateTitle:d,refreshTitle:l}:{isReady:!1,title:"",updateTitle:e=>{},refreshTitle:()=>{}}},b=()=>{let[e,t]=(0,a.useState)(""),[r,i]=(0,a.useState)(),[n,o]=(0,a.useState)(),[c,y]=(0,a.useState)(!1),l=(0,a.useCallback)(()=>{void 0!==r&&t(r.getCurrentDiaryEntry().getContent())},[r]),d=(0,a.useCallback)(e=>{void 0!==n&&void 0!==l&&(n.editContent(e),l())},[n,l]);return((0,a.useEffect)(()=>{i(s.kL.resolve("ICurrentDiaryEntryAccessor")),o(s.kL.resolve("IEditDiaryEntry")),y(!0),l()},[]),c&&void 0!==d&&void 0!==l)?{isReady:c,content:e,updateContent:d,refreshContent:l}:{isReady:!1,content:"",updateContent:e=>{},refreshContent:()=>{}}},C=()=>{let[e,t]=(0,a.useState)(),[r,i]=(0,a.useState)(!1);(0,a.useEffect)(()=>{t(s.kL.resolve("IEditDiaryEntry")),i(!0)},[]);let n=(0,a.useCallback)(()=>{r&&void 0!==e&&e.clear()},[r]);return{isReady:r,clear:n}},I=(0,a.createContext)(null),N=(0,a.createContext)(null),j=(0,a.createContext)(null),A=e=>{let{children:t}=e,{title:r,updateTitle:n,refreshTitle:o}=x(),{content:c,updateContent:l,refreshContent:d}=b(),{clear:g}=C(),{entryRefresherRegister:h,refreshEntry:D}=y(),{}=u(),[m,f]=(0,a.useState)();(0,a.useEffect)(()=>{f(s.kL.resolve("ICurrentDiaryEntryAccessor"));let e=()=>{o(),d()};return e(),h(e)},[h,o,d]);let{updateDiaryEntryTitle:v}=u(),p=(0,a.useMemo)(()=>({title:r,updateTitle:e=>{void 0!==m&&(n(e),v(m.getCurrentDiaryEntry().day,e))}}),[r,n,m,v]),S=(0,a.useMemo)(()=>({content:c,updateContent:l}),[c,l]),E=(0,a.useMemo)(()=>({clearEntry:()=>{if(void 0!==m)g(),D(),v(m.getCurrentDiaryEntry().day,m.getCurrentDiaryEntry().getTitle())}}),[g,D,m]);return(0,i.jsx)(I.Provider,{value:p,children:(0,i.jsx)(N.Provider,{value:S,children:(0,i.jsx)(j.Provider,{value:E,children:t})})})},L=()=>{let e=(0,a.useContext)(I);if(null===e)throw Error("useDiaryEntryTitleContext must be used within a DiaryEntryTitleContext");return e},k=()=>{let e=(0,a.useContext)(N);if(null===e)throw Error("useDiaryEntryContentContext must be used within a DiaryEntryContentContext");return e},_=()=>{let e=(0,a.useContext)(j);if(null===e)throw Error("useDiaryEntryResetContext must be used within a DiaryEntryResetContext");return e},w=(0,a.createContext)(null),M=e=>{let{children:t}=e,[r,n]=(0,a.useState)(),[o,c]=(0,a.useState)("");(0,a.useEffect)(()=>{n(s.kL.resolve("ICurrentDiaryManager"))},[]);let y=(0,a.useCallback)(()=>{void 0!==r&&c(r.getCurrentDiaryKey())},[r]),l=(0,a.useMemo)(()=>({selectedOption:o,setSelectedOption:c,selectCurrentDiary:y}),[o,c,y]);return void 0===l?(0,i.jsx)("div",{children:"Loading..."}):(0,i.jsx)(w.Provider,{value:l,children:t})},F=()=>{let e=(0,a.useContext)(w);if(null===e)throw Error("useSelectedDiaryContext must be used within a DiaryNameListProvider");return e};var O=r(9249);class Q{}Q.CURRENT_VERSION=1,Q.DEFAULT_DIARY_NAME="新しい日記",Q.DEFAULT_DAY_INTERVAL=1,Q.DEFAULT_CYCLE_LENGTH=10,Q.YEAR_PLACEHOLDER="$Y",Q.CYCLE_PLACEHOLDER="$C",Q.DAY_PLACEHOLDER="$D",Q.TOTAL_DAYS_PLACEHOLDER="$N",Q.DEFAULT_DAY_MODIFIER=Q.TOTAL_DAYS_PLACEHOLDER+"日目",Q.CURRENT_GAME_DATA_NAME="currentGameDataName",Q.CURRENT_DIARY_KEY="currentDiaryKey",Q.GAME_DATA_NAME_LIST="gameDataNameList",Q.DIARY_NAME_LIST="diaryNameList",Q.HOW_TO_USE_TEXT_URL="./使い方.txt",Q.HOW_TO_USE_KEY="862c89fc-908c-439d-8443-db7d29ab25c5";class T{get day(){return this._day}setTitle(e){this.title=e}getTitle(){return this.title}setContent(e){this.content=e}getContent(){return this.content}get previous(){return this._previous}get next(){return this._next}set previous(e){let t=Math.trunc(e);void 0!==t&&this.day>t&&t>0&&(this._previous=t)}set next(e){if(void 0===e){this._next=e;return}let t=Math.trunc(e);this.day<t&&(this._next=t)}isEdited(e){return""!==this.content||""!==this.title&&this.title!==e.getModifierDay(this.day)}toJSON(){return{day:this.day,title:this.title,content:this.content,next:this.next}}constructor(e=1,t="1"+Q.DEFAULT_DAY_MODIFIER,r="",i,a){this._day=e,this.title=t,this.content=r,this._previous=i,this._next=a}}T=(0,O.Cg)([(0,s._G)(),(0,O.Qj)(0,(0,s.WQ)("FIRST_DAY")),(0,O.Qj)(1,(0,s.WQ)("DEFAULT_TITLE")),(0,O.Qj)(2,(0,s.WQ)("EMPTY_STRING")),(0,O.Qj)(3,(0,s.WQ)("UNDEFINED")),(0,O.Qj)(4,(0,s.WQ)("UNDEFINED")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",[Number,String,String,Object,Object])],T);class R extends Error{}class U extends Error{}class W extends Error{}class Y extends Error{}class G extends Error{}var K=r(6733),P=r.n(K);class H{getSettings(){return this.settings}getLastDay(){return this.lastDay}createNewEntry(){let e=this.diaryEntries.get(this.lastDay);P()(void 0!==e,new R("not exists day=".concat(this.lastDay)));let t=this.builder(e,this.settings);return this.diaryEntries.set(t.day,t),this.getEntry(this.lastDay).next=t.day,this.lastDay=t.day,t.day}getEntry(e){let t=this.diaryEntries.get(e);return P()(void 0!==t,new R("not exists day=".concat(e," entry"))),t}deleteEntry(e){let t=this.diaryEntries.get(e);if(void 0===t)return!1;let r=void 0!==t.previous?this.getEntry(t.previous):void 0,i=void 0!==t.next?this.getEntry(t.next):void 0;if(this.lastDay===e&&void 0!==r)r.next=void 0,this.lastDay=r.day;else{if(void 0==r||void 0==i)return!1;r.next=i.day,i.previous=r.day}return this.diaryEntries.delete(e)}toJSON(){return{settings:this.settings,diaryEntries:this.diaryEntries.values().toArray(),lastDay:this.lastDay}}constructor(e,t,r,i=1){this.builder=e,this.diaryEntries=t,this.settings=r,this.lastDay=i,P()(0!==t.size,"not exists any entry"),P()(void 0!==t.get(i),"not exists ".concat(i))}}H=(0,O.Cg)([(0,s._G)(),(0,O.Qj)(0,(0,s.WQ)("UsePreviousDayDiaryEntryFactory")),(0,O.Qj)(1,(0,s.WQ)("DIARY_ENTRIES_CONTAINING_FIRST_DAY")),(0,O.Qj)(2,(0,s.WQ)("IDiarySettings")),(0,O.Qj)(3,(0,s.WQ)("FIRST_DAY")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",["undefined"==typeof UsePreviousDayDiaryEntryFactory?Object:UsePreviousDayDiaryEntryFactory,"undefined"==typeof Map?Object:Map,"undefined"==typeof IDiarySettings?Object:IDiarySettings,Number])],H);class V{setModifier(e){this.modifier=e}getModifier(){return this.modifier}updateCycleLength(e){let t=Math.trunc(e);!(t<1)&&(this.cycleLength=t)}getCycleLength(){return this.cycleLength}getUnit(e){let t=Math.trunc(e);return t>=this.unit.length||t<0?"":this.unit[t]}updateUnit(e,t){let r=Math.trunc(t);if(r<0||3<r)return;let i=r-this.unit.length;i>0&&this.unit.push(...Array(i).fill("")),this.unit[r]=e,this.maintainValidUnitLength()}maintainValidUnitLength(){for(;this.unit.length>0&&""===this.unit[this.unit.length-1];)this.unit.pop()}modifyDay(e){let t=Math.trunc(e),r=this.unit.length;if(0===r)return this.modifier.includes(Q.TOTAL_DAYS_PLACEHOLDER)?this.modifier.replace(Q.TOTAL_DAYS_PLACEHOLDER,String(t)):String(t)+this.modifier;if(!(this.modifier.includes(Q.TOTAL_DAYS_PLACEHOLDER)||this.modifier.includes(Q.YEAR_PLACEHOLDER)||this.modifier.includes(Q.CYCLE_PLACEHOLDER)||this.modifier.includes(Q.DAY_PLACEHOLDER)))return String(t)+this.modifier;let i=String(Math.trunc((t-1)/(this.cycleLength*r))+1),a=t%this.cycleLength,s=String(0!==a?a:this.cycleLength),n=Math.trunc((t-1)/this.cycleLength),o=this.getUnit(n%r);return this.modifier.replace(Q.YEAR_PLACEHOLDER,i).replace(Q.CYCLE_PLACEHOLDER,o).replace(Q.DAY_PLACEHOLDER,s).replace(Q.TOTAL_DAYS_PLACEHOLDER,String(t))}constructor(e,t,...r){this.modifier=e,this.cycleLength=t,this.unit=[...r],this.unit=this.unit.slice(0,4),this.maintainValidUnitLength()}}V=(0,O.Cg)([(0,s._G)(),(0,O.Qj)(0,(0,s.WQ)("DAY_MODIFIER")),(0,O.Qj)(1,(0,s.WQ)("CYCLE_LENGTH")),(0,O.Qj)(2,(0,s.WQ)("EMPTY_STRING")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",[String,Number,"undefined"==typeof Array?Object:Array])],V);class J{get storageKey(){return this._storageKey}get version(){return this._version}getDayInterval(){return this.dayInterval}updateDayInterval(e){let t=Math.trunc(e);if(t<=0||!Number.isSafeInteger(t)){this.dayInterval=1;return}this.dayInterval=t}setDiaryName(e){this.diaryName=e}getDiaryName(){return this.diaryName}setModifier(e){this.dayModifier.setModifier(e)}getModifier(){return this.dayModifier.getModifier()}updateCycleLength(e){this.dayModifier.updateCycleLength(e)}getCycleLength(){return this.dayModifier.getCycleLength()}updateModifierUnit(e,t){this.dayModifier.updateUnit(e,t)}getModifierUnit(e){return this.dayModifier.getUnit(e)}getNextDay(e){let t=Math.trunc(e);return t<1?this.dayInterval+1:t+this.dayInterval}getModifierDay(e){let t=Math.trunc(e);return this.dayModifier.modifyDay(t>1?t:1)}constructor(e,t,r,i,a){this.dayModifier=e,this.diaryName=t,this.dayInterval=r,this._storageKey=i,this._version=a}}J=(0,O.Cg)([(0,s._G)(),(0,O.Qj)(0,(0,s.WQ)("IDayModifier")),(0,O.Qj)(1,(0,s.WQ)("DIARY_NAME")),(0,O.Qj)(2,(0,s.WQ)("DAY_INTERVAL")),(0,O.Qj)(3,(0,s.WQ)("STORAGE_KEY")),(0,O.Qj)(4,(0,s.WQ)("VERSION")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",["undefined"==typeof IDayModifier?Object:IDayModifier,String,Number,String,Number])],J);class z{getItem(e){return this.storage.getItem(e)}setItem(e,t){this.storage.setItem(e,t)}removeItem(e){this.storage.removeItem(e)}get length(){return this.storage.length}constructor(e){this.storage=e}}z=(0,O.Cg)([(0,s._G)(),(0,O.Qj)(0,(0,s.WQ)("LocalStorage")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",["undefined"==typeof Storage?Object:Storage])],z);class B{createUseExistingData(e,t,r){return new H(this.builder,e,t,r)}createNewDiary(e,t){let r=this.newEntriesFactory(),i=this.settingsFactory.createNewDiarySettings(null==e?void 0:e.getSettings(),t);return new H(this.builder,r,i,1)}constructor(e,t,r){this.newEntriesFactory=e,this.settingsFactory=t,this.builder=r}}B=(0,O.Cg)([(0,s._G)(),(0,O.Qj)(0,(0,s.WQ)("NewDiaryEntriesFactory")),(0,O.Qj)(1,(0,s.WQ)("IDiarySettingsFactory")),(0,O.Qj)(2,(0,s.WQ)("UsePreviousDayDiaryEntryFactory")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",["undefined"==typeof NewDiaryEntriesFactory?Object:NewDiaryEntriesFactory,"undefined"==typeof IDiarySettingsFactory?Object:IDiarySettingsFactory,"undefined"==typeof UsePreviousDayDiaryEntryFactory?Object:UsePreviousDayDiaryEntryFactory])],B);class ${createUsePreviousDay(e,t){let r=t.getNextDay(e.day),i=t.getModifierDay(r);return new T(r,i,"",e.day,void 0)}createUseExistingData(e,t,r,i,a){return new T(e,t,r,i,a)}}class q{createUseExistingData(e,t,r,i){return new J(e,t,r,i,this.version)}createNewDiarySettings(e,t){void 0===e&&(e=this.defaultSettingsFactory());let r=[,,,,];for(let t=0;t<r.length;t++)r[t]=e.getModifierUnit(t);let i=this.modifierFactory(e.getModifier(),e.getCycleLength(),...r),a=e.getDayInterval(),s=this.StorageKeyFactory();return new J(i,null!=t?t:e.getDiaryName(),a,s,this.version)}constructor(e,t,r,i){this.defaultSettingsFactory=e,this.modifierFactory=t,this.StorageKeyFactory=r,this.version=i}}q=(0,O.Cg)([(0,s._G)(),(0,O.Qj)(0,(0,s.WQ)("DefaultSettingsFactory")),(0,O.Qj)(1,(0,s.WQ)("UseExistingDataDayModifierFactory")),(0,O.Qj)(2,(0,s.WQ)("StorageKeyFactory")),(0,O.Qj)(3,(0,s.WQ)("VERSION")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",["undefined"==typeof DefaultSettingsFactory?Object:DefaultSettingsFactory,"undefined"==typeof UseExistingDataDayModifierFactory?Object:UseExistingDataDayModifierFactory,"undefined"==typeof StorageKeyFactory?Object:StorageKeyFactory,Number])],q);class X{getDiary(e){return this.diaries.get(e)}addDiary(e){this.diaries.set(e.getSettings().storageKey,e),this.diarySave.save(e)}deleteDiary(e){this.diaries.delete(e),this.storage.removeItem(e)}constructor(e,t){this.diarySave=e,this.storage=t,this.diaries=new Map}}function Z(e,t,r){return t in e&&ee(e[t],r)}function ee(e,t){return typeof e===t&&null!==e||"Array"===t&&e instanceof Array||"record"===t&&"object"==typeof e&&null!==e&&!Array.isArray(e)&&Object.getPrototypeOf(e)===Object.prototype}function et(e,t){return e.every(e=>typeof e===t)}X=(0,O.Cg)([(0,s._G)(),(0,O.Qj)(0,(0,s.WQ)("IDiarySave")),(0,O.Qj)(1,(0,s.WQ)("IStorageService")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",["undefined"==typeof IDiarySave?Object:IDiarySave,"undefined"==typeof IStorageService?Object:IStorageService])],X);class er{get length(){return this.diaryNameSet.size}collectDiaryNameEntries(){return Object.entries(this.diaryNames)}getDiaryName(e){return this.diaryNames[e]}updateDiaryName(e,t){return!(""===e||""===t||this.diaryNameSet.has(t))&&(this.diaryNameSet.delete(this.diaryNames[e]),this.diaryNameSet.add(t),this.diaryNames[e]=t,this.isStorageAvailable(this.storage)&&this.storage.setItem(Q.DIARY_NAME_LIST,JSON.stringify(this.diaryNames)),!0)}removeDiaryName(e){let t=this.diaryNames[e];void 0!==t&&(this.diaryNameSet.delete(t),delete this.diaryNames[e],this.isStorageAvailable(this.storage)&&this.storage.setItem(Q.DIARY_NAME_LIST,JSON.stringify(this.diaryNames)))}hasDiaryName(e){return this.diaryNameSet.has(e)}constructor(e,t){this.storage=e,this.isStorageAvailable=t,this.diaryNameSet=new Set,this.diaryNames={};let r=e.getItem(Q.DIARY_NAME_LIST);if(null===r)return;let i=JSON.parse(r);if(!ee(i,"record"))throw new Y("diary_name_list is broken");Object.entries(i).filter(e=>ee(e[0],"string")&&ee(e[1],"string")).forEach(e=>{this.diaryNames[e[0]]=e[1],this.diaryNameSet.add(e[1])})}}er=(0,O.Cg)([(0,s._G)(),(0,O.Qj)(0,(0,s.WQ)("IStorageService")),(0,O.Qj)(1,(0,s.WQ)("IsStorageAvailableFunc")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",["undefined"==typeof IStorageService?Object:IStorageService,"undefined"==typeof IsStorageAvailableFunc?Object:IsStorageAvailableFunc])],er);class ei{migrate(){null!==this.storage.getItem(Q.CURRENT_GAME_DATA_NAME)&&this.migrateV0toV1()}migrateV0toV1(){let e=this.storage.getItem(Q.CURRENT_GAME_DATA_NAME);null!==e&&(this.storage.removeItem(Q.CURRENT_GAME_DATA_NAME),this.storage.setItem(Q.CURRENT_DIARY_KEY,e));let t=this.storage.getItem(Q.GAME_DATA_NAME_LIST);if(null===t)return;let r=JSON.parse(t);if(!ee(r,"Array")||!et(r,"object")||!r.every(e=>Z(e,"storageKey","string")&&Z(e,"playGamedataName","string")))throw new Y("game_data_name_list is broken");let i={};r.map(e=>{i[e.storageKey]=e.playGamedataName}),this.storage.removeItem(Q.GAME_DATA_NAME_LIST),this.storage.setItem(Q.DIARY_NAME_LIST,JSON.stringify(i))}constructor(e){this.storage=e}}ei=(0,O.Cg)([(0,s._G)(),(0,O.Qj)(0,(0,s.WQ)("IStorageService")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",["undefined"==typeof IStorageService?Object:IStorageService])],ei);class ea{generate(e,t){if(void 0!==t&&this.diaryNameManager.getDiaryName(t)===e)return e;let r=e,i=1;for(;this.diaryNameManager.hasDiaryName(r);)r=e+String(i),i++;return r}constructor(e){this.diaryNameManager=e}}ea=(0,O.Cg)([(0,s._G)(),(0,O.Qj)(0,(0,s.WQ)("IDiaryNameManager")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",["undefined"==typeof IDiaryNameManager?Object:IDiaryNameManager])],ea);class es{getCurrentDiaryKey(){return this.currentDiaryKey}setCurrentDiaryKey(e){this.currentDiaryKey=e,this.isStorageAvailable(this.storage)&&this.storage.setItem(Q.CURRENT_DIARY_KEY,e)}constructor(e,t){this.storage=e,this.isStorageAvailable=t,this.currentDiaryKey="";let r=this.storage.getItem(Q.CURRENT_DIARY_KEY);if(null!==r){this.currentDiaryKey=r;return}}}es=(0,O.Cg)([(0,s._G)(),(0,O.Qj)(0,(0,s.WQ)("IStorageService")),(0,O.Qj)(1,(0,s.WQ)("IsStorageAvailableFunc")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",["undefined"==typeof IStorageService?Object:IStorageService,"undefined"==typeof IsStorageAvailableFunc?Object:IsStorageAvailableFunc])],es);class en{import(e){let t=this.diaryDecompressor.decompressDiary(e);this.diaryService.addDiary(t);let r=this.diaryNameService.updateDiaryName(t.getSettings().storageKey,t.getSettings().getDiaryName());return t.getSettings().setDiaryName(r),t.getSettings().storageKey}constructor(e,t,r){this.diaryService=e,this.diaryDecompressor=t,this.diaryNameService=r}}en=(0,O.Cg)([(0,s._G)(),(0,O.Qj)(0,(0,s.WQ)("IDiaryService")),(0,O.Qj)(1,(0,s.WQ)("IDiaryDecompressor")),(0,O.Qj)(2,(0,s.WQ)("IDiaryNameService")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",["undefined"==typeof IDiaryService?Object:IDiaryService,"undefined"==typeof IDiaryDecompressor?Object:IDiaryDecompressor,"undefined"==typeof IDiaryNameService?Object:IDiaryNameService])],en);class eo{export(e){let t=this.diaryService.getDiary(e);return void 0===t?"":this.compressDiary(t)}constructor(e,t){this.diaryService=e,this.compressDiary=t}}eo=(0,O.Cg)([(0,s._G)(),(0,O.Qj)(0,(0,s.WQ)("IDiaryService")),(0,O.Qj)(1,(0,s.WQ)("CompressDiary")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",["undefined"==typeof IDiaryService?Object:IDiaryService,"undefined"==typeof CompressDiary?Object:CompressDiary])],eo);class ec{save(e){if(!this.isStorageAvailable(this.storage))throw new G("can not you use the storage");this.storage.setItem(e.getSettings().storageKey,this.compressDiary(e))}constructor(e,t,r){this.storage=e,this.compressDiary=t,this.isStorageAvailable=r}}ec=(0,O.Cg)([(0,s._G)(),(0,O.Qj)(0,(0,s.WQ)("IStorageService")),(0,O.Qj)(1,(0,s.WQ)("CompressDiary")),(0,O.Qj)(2,(0,s.WQ)("IsStorageAvailableFunc")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",["undefined"==typeof IStorageService?Object:IStorageService,"undefined"==typeof CompressDiary?Object:CompressDiary,"undefined"==typeof IsStorageAvailableFunc?Object:IsStorageAvailableFunc])],ec);class ey{load(e){let t=this.diaryService.getDiary(e);if(void 0!==t)return t;let r=this.storage.getItem(e);if(null===r)throw new R('Key "'.concat(e,'" not found'));let i=this.diaryDecompressor.decompressDiary(r),a=this.diaryNameService.updateDiaryName(i.getSettings().storageKey,i.getSettings().getDiaryName());return i.getSettings().setDiaryName(a),this.diaryService.addDiary(i),i}constructor(e,t,r,i){this.diaryService=e,this.storage=t,this.diaryDecompressor=r,this.diaryNameService=i}}ey=(0,O.Cg)([(0,s._G)(),(0,O.Qj)(0,(0,s.WQ)("IDiaryService")),(0,O.Qj)(1,(0,s.WQ)("IStorageService")),(0,O.Qj)(2,(0,s.WQ)("IDiaryDecompressor")),(0,O.Qj)(3,(0,s.WQ)("IDiaryNameService")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",["undefined"==typeof IDiaryService?Object:IDiaryService,"undefined"==typeof IStorageService?Object:IStorageService,"undefined"==typeof IDiaryDecompressor?Object:IDiaryDecompressor,"undefined"==typeof IDiaryNameService?Object:IDiaryNameService])],ey);class el{getCurrentDiary(){let e=this.currentDiaryManager.getCurrentDiaryKey(),t=this.diaryService.getDiary(e);return void 0===t?this.diaryLoad.load(e):t}setCurrentDiary(e){void 0!==this.diaryService.getDiary(e)&&this.currentDiaryManager.setCurrentDiaryKey(e)}constructor(e,t,r){this.currentDiaryManager=e,this.diaryService=t,this.diaryLoad=r}}el=(0,O.Cg)([(0,s._G)(),(0,O.Qj)(0,(0,s.WQ)("ICurrentDiaryManager")),(0,O.Qj)(1,(0,s.WQ)("IDiaryService")),(0,O.Qj)(2,(0,s.WQ)("IDiaryLoad")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",["undefined"==typeof ICurrentDiaryManager?Object:ICurrentDiaryManager,"undefined"==typeof IDiaryService?Object:IDiaryService,"undefined"==typeof IDiaryLoad?Object:IDiaryLoad])],el);class ed{create(e){let t=this.diaryAccessor.getCurrentDiary(),r=this.diaryFactory.createNewDiary(t,e),{key:i,name:a}=this.finalizeDiary(r);return{key:i,name:a}}createDefaultDiary(){let e=this.diaryFactory.createNewDiary(),{key:t,name:r}=this.finalizeDiary(e);return{key:t,name:r}}finalizeDiary(e){this.diaryService.addDiary(e);let t=e.getSettings(),r=e.getLastDay(),i=t.getModifierDay(r);e.getEntry(r).setTitle(i);let a=t.getDiaryName(),s=t.storageKey;return this.diaryNameService.updateDiaryName(s,a),this.diaryAccessor.setCurrentDiary(s),{key:s,name:a}}constructor(e,t,r,i){this.diaryAccessor=e,this.diaryFactory=t,this.diaryService=r,this.diaryNameService=i}}ed=(0,O.Cg)([(0,s._G)(),(0,O.Qj)(0,(0,s.WQ)("ICurrentDiaryAccessor")),(0,O.Qj)(1,(0,s.WQ)("IDiaryFactory")),(0,O.Qj)(2,(0,s.WQ)("IDiaryService")),(0,O.Qj)(3,(0,s.WQ)("IDiaryNameService")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",["undefined"==typeof ICurrentDiaryAccessor?Object:ICurrentDiaryAccessor,"undefined"==typeof IDiaryFactory?Object:IDiaryFactory,"undefined"==typeof IDiaryService?Object:IDiaryService,"undefined"==typeof IDiaryNameService?Object:IDiaryNameService])],ed);class eu{delete(e){return this.currentDiaryManager.getCurrentDiaryKey()!==e&&(this.diaryService.deleteDiary(e),this.diaryNameService.removeDiaryName(e),!0)}constructor(e,t,r){this.currentDiaryManager=e,this.diaryService=t,this.diaryNameService=r}}eu=(0,O.Cg)([(0,s._G)(),(0,O.Qj)(0,(0,s.WQ)("ICurrentDiaryManager")),(0,O.Qj)(1,(0,s.WQ)("IDiaryService")),(0,O.Qj)(2,(0,s.WQ)("IDiaryNameService")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",["undefined"==typeof ICurrentDiaryManager?Object:ICurrentDiaryManager,"undefined"==typeof IDiaryService?Object:IDiaryService,"undefined"==typeof IDiaryNameService?Object:IDiaryNameService])],eu);class eg{importText(e){let t=this.diaryImport.import(e);return this.diaryAccessor.setCurrentDiary(t),t}async importFile(e){return new Promise((t,r)=>{try{let r=new FileReader;r.onload=()=>{let e=r.result,i=this.diaryImport.import(e);this.diaryAccessor.setCurrentDiary(i),t(i)},r.readAsText(e)}catch(e){r(e)}})}constructor(e,t){this.diaryImport=e,this.diaryAccessor=t}}eg=(0,O.Cg)([(0,s._G)(),(0,O.Qj)(0,(0,s.WQ)("IDiaryImport")),(0,O.Qj)(1,(0,s.WQ)("ICurrentDiaryAccessor")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",["undefined"==typeof IDiaryImport?Object:IDiaryImport,"undefined"==typeof ICurrentDiaryAccessor?Object:ICurrentDiaryAccessor])],eg);class eh{exportText(){let e=this.diaryAccessor.getCurrentDiary();return this.diaryExport.export(e.getSettings().storageKey)}exportFile(){let e=this.diaryAccessor.getCurrentDiary(),t="".concat(e.getSettings().getDiaryName(),".txt");return{data:new Blob([this.diaryExport.export(e.getSettings().storageKey)],{type:"text/plain"}),fileName:t}}constructor(e,t){this.diaryExport=e,this.diaryAccessor=t}}eh=(0,O.Cg)([(0,s._G)(),(0,O.Qj)(0,(0,s.WQ)("IDiaryExport")),(0,O.Qj)(1,(0,s.WQ)("ICurrentDiaryAccessor")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",["undefined"==typeof IDiaryExport?Object:IDiaryExport,"undefined"==typeof ICurrentDiaryAccessor?Object:ICurrentDiaryAccessor])],eh);class eD{load(e){this.diaryAccessor.getCurrentDiary().getSettings().storageKey!==e&&(this.diaryLoad.load(e),this.diaryAccessor.setCurrentDiary(e))}constructor(e,t){this.diaryLoad=e,this.diaryAccessor=t}}eD=(0,O.Cg)([(0,s._G)(),(0,O.Qj)(0,(0,s.WQ)("IDiaryLoad")),(0,O.Qj)(1,(0,s.WQ)("ICurrentDiaryAccessor")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",["undefined"==typeof IDiaryLoad?Object:IDiaryLoad,"undefined"==typeof ICurrentDiaryAccessor?Object:ICurrentDiaryAccessor])],eD);class em{save(){let e=this.diaryAccessor.getCurrentDiary();this.diarySave.save(e)}constructor(e,t){this.diarySave=e,this.diaryAccessor=t}}em=(0,O.Cg)([(0,s._G)(),(0,O.Qj)(0,(0,s.WQ)("IDiarySave")),(0,O.Qj)(1,(0,s.WQ)("ICurrentDiaryAccessor")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",["undefined"==typeof IDiarySave?Object:IDiarySave,"undefined"==typeof ICurrentDiaryAccessor?Object:ICurrentDiaryAccessor])],em);class ef{editDiaryName(e){let t=this.diaryNameService.updateDiaryName(this.getSettings().storageKey,e);this.getSettings().setDiaryName(t)}editDayInterval(e){this.getSettings().updateDayInterval(e)}editModifier(e){this.getSettings().setModifier(e)}editModifierCycle(e,t){this.getSettings().updateModifierUnit(t,e)}editCycleLength(e){this.getSettings().updateCycleLength(e)}getSettings(){return this.diaryAccessor.getCurrentDiary().getSettings()}constructor(e,t){this.diaryAccessor=e,this.diaryNameService=t}}ef=(0,O.Cg)([(0,s._G)(),(0,O.Qj)(0,(0,s.WQ)("ICurrentDiaryAccessor")),(0,O.Qj)(1,(0,s.WQ)("IDiaryNameService")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",["undefined"==typeof ICurrentDiaryAccessor?Object:ICurrentDiaryAccessor,"undefined"==typeof IDiaryNameService?Object:IDiaryNameService])],ef);class ev{moveByDate(e){this.diaryEntryAccessor.setCurrentDiaryEntry(e)}moveToNext(){let e=this.diaryEntryAccessor.getCurrentDiaryEntry();if(void 0!==e.next)return this.diaryEntryAccessor.setCurrentDiaryEntry(e.next),!1;let t=this.diaryAccessor.getCurrentDiary().createNewEntry();return this.diaryEntryAccessor.setCurrentDiaryEntry(t),!0}moveToPrevious(){let e=this.diaryEntryAccessor.getCurrentDiaryEntry();if(void 0===e.previous)return!1;this.diaryEntryAccessor.setCurrentDiaryEntry(e.previous);let t=this.diaryAccessor.getCurrentDiary().getSettings();return!e.isEdited(t)&&void 0===e.next&&(this.diaryAccessor.getCurrentDiary().deleteEntry(e.day),!0)}constructor(e,t){this.diaryAccessor=e,this.diaryEntryAccessor=t}}ev=(0,O.Cg)([(0,s._G)(),(0,O.Qj)(0,(0,s.WQ)("ICurrentDiaryAccessor")),(0,O.Qj)(1,(0,s.WQ)("ICurrentDiaryEntryAccessor")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",["undefined"==typeof ICurrentDiaryAccessor?Object:ICurrentDiaryAccessor,"undefined"==typeof ICurrentDiaryEntryAccessor?Object:ICurrentDiaryEntryAccessor])],ev);class ep{getCurrentDiaryEntry(){if(void 0===this.entry){let e=this.diaryAccessor.getCurrentDiary(),t=e.getLastDay();this.entry=e.getEntry(t)}return this.entry}setCurrentDiaryEntry(e){let t=this.diaryAccessor.getCurrentDiary();this.entry=t.getEntry(e)}constructor(e){this.diaryAccessor=e}}ep=(0,O.Cg)([(0,s._G)(),(0,O.Qj)(0,(0,s.WQ)("ICurrentDiaryAccessor")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",["undefined"==typeof ICurrentDiaryAccessor?Object:ICurrentDiaryAccessor])],ep);class eS{delete(e){this.diaryAccessor.getCurrentDiary().deleteEntry(e)}constructor(e){this.diaryAccessor=e}}eS=(0,O.Cg)([(0,O.Qj)(0,(0,s.WQ)("ICurrentDiaryAccessor")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",["undefined"==typeof ICurrentDiaryAccessor?Object:ICurrentDiaryAccessor])],eS);class eE{editTitle(e){this.getEntry().setTitle(e)}editContent(e){this.getEntry().setContent(e)}clear(){let e=this.getEntry().day,t=this.getSettings().getModifierDay(e);this.getEntry().setTitle(t),this.getEntry().setContent("")}getEntry(){return this.diaryEntryAccessor.getCurrentDiaryEntry()}getSettings(){return this.diaryAccessor.getCurrentDiary().getSettings()}constructor(e,t){this.diaryEntryAccessor=e,this.diaryAccessor=t}}eE=(0,O.Cg)([(0,s._G)(),(0,O.Qj)(0,(0,s.WQ)("ICurrentDiaryEntryAccessor")),(0,O.Qj)(1,(0,s.WQ)("ICurrentDiaryAccessor")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",["undefined"==typeof ICurrentDiaryEntryAccessor?Object:ICurrentDiaryEntryAccessor,"undefined"==typeof ICurrentDiaryAccessor?Object:ICurrentDiaryAccessor])],eE);var ex=r(9345);class eb{decompressDiary(e){let t=(0,ex.decompressFromEncodedURIComponent)(e);if(null===t)throw new W("Could not decompress: ".concat(e));let r=JSON.parse(t);if(!ee(r,"object"))throw new Y("Could not deserialize");if(!Z(r,"settings","object"))throw new Y("JSON is broken");if(!Z(r.settings,"_version","number"))return function(e,t,r,i,a){if(!Z(e,"lastDay","number"))throw new Y("Diary class is broken");if(!Z(e,"settings","object")||!Z(e.settings,"storageKey","string")||!Z(e.settings,"playGamedataName","string")||!Z(e.settings,"dayInterval","number")||!Z(e.settings,"unitOfDay","object")||!Z(e.settings.unitOfDay,"unit","Array")||!et(e.settings.unitOfDay.unit,"string")||!Z(e.settings.unitOfDay,"CycleInUnitChanges","number")||5!==e.settings.unitOfDay.unit.length)throw new Y("Settings class is broken");let s=t(e.settings.unitOfDay.unit[0],e.settings.unitOfDay.CycleInUnitChanges,e.settings.unitOfDay.unit[1],e.settings.unitOfDay.unit[2],e.settings.unitOfDay.unit[3],e.settings.unitOfDay.unit[4]),n=r.createUseExistingData(s,e.settings.playGamedataName,e.settings.dayInterval,e.settings.storageKey);if(!Z(e,"dayReports","Array"))throw new Y("Array<DayReport> class is broken");let o=new Map;for(let t of e.dayReports){if(!ee(t,"Array")||t.length<1||!ee(t[1],"object")||!Z(t[1],"day","number")||!Z(t[1],"reportTitle","string")||!Z(t[1],"report","string"))throw new Y("DayReport class is broken");let e=i(t[1].day,t[1].reportTitle,t[1].report,Z(t[1],"previous","number")?t[1].previous:void 0,Z(t[1],"next","number")?t[1].next:void 0);o.set(e.day,e)}return a.createUseExistingData(o,n,e.lastDay)}(r,this.dayModifierFactory,this.diarySettingsFactory,this.diaryEntryFactory,this.diaryFactory);if(1===r.settings._version)return function(e,t,r,i,a){if(!Z(e,"lastDay","number"))throw new Y("Reports class is broken");if(!Z(e,"settings","object")||!Z(e.settings,"_storageKey","string")||!Z(e.settings,"diaryName","string")||!Z(e.settings,"dayInterval","number")||!Z(e.settings,"dayModifier","object")||!Z(e.settings,"_version","number"))throw new Y("Settings class is broken");if(!Z(e.settings.dayModifier,"modifier","string")||!Z(e.settings.dayModifier,"cycleLength","number")||!Z(e.settings.dayModifier,"unit","Array")||!et(e.settings.dayModifier.unit,"string")||e.settings.dayModifier.unit.length>4)throw new Y("DayModifier class is broken");let s=t(e.settings.dayModifier.modifier,e.settings.dayModifier.cycleLength,...e.settings.dayModifier.unit),n=r.createUseExistingData(s,e.settings.diaryName,e.settings.dayInterval,e.settings._storageKey);if(!Z(e,"diaryEntries","Array"))throw new Y("Array<DayReport> class is broken");if(!e.diaryEntries.every(e=>ee(e,"object")&&Z(e,"day","number")&&Z(e,"title","string")&&Z(e,"content","string")))throw new Y("DayReport class is broken");let o=new Map,c=new Map;for(let t of e.diaryEntries){Z(t,"next","number")&&c.set(t.next,t.day);let e=i(t.day,t.title,t.content,c.get(t.day),Z(t,"next","number")?t.next:void 0);o.set(e.day,e)}return a.createUseExistingData(o,n,e.lastDay)}(r,this.dayModifierFactory,this.diarySettingsFactory,this.diaryEntryFactory,this.diaryFactory);throw new U("version=v".concat(r.settings._version," is not supported"))}constructor(e,t,r,i){this.dayModifierFactory=e,this.diarySettingsFactory=t,this.diaryEntryFactory=r,this.diaryFactory=i}}eb=(0,O.Cg)([(0,s._G)(),(0,O.Qj)(0,(0,s.WQ)("UseExistingDataDayModifierFactory")),(0,O.Qj)(1,(0,s.WQ)("IDiarySettingsFactory")),(0,O.Qj)(2,(0,s.WQ)("UseExistingDataDiaryEntryFactory")),(0,O.Qj)(3,(0,s.WQ)("IDiaryFactory")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",["undefined"==typeof UseExistingDataDayModifierFactory?Object:UseExistingDataDayModifierFactory,"undefined"==typeof IDiarySettingsFactory?Object:IDiarySettingsFactory,"undefined"==typeof UseExistingDataDiaryEntryFactory?Object:UseExistingDataDiaryEntryFactory,"undefined"==typeof IDiaryFactory?Object:IDiaryFactory])],eb);class eC{get length(){return this.diaryNameManager.length}collectDiaryNameEntries(){return this.diaryNameManager.collectDiaryNameEntries()}getDiaryName(e){return this.diaryNameManager.getDiaryName(e)}addDiaryName(e,t){return this.updateDiaryName(e,t)}updateDiaryName(e,t){let r=this.nameGenerator.generate(t,e);return this.diaryNameManager.updateDiaryName(e,r),r}removeDiaryName(e){this.diaryNameManager.removeDiaryName(e)}hasDiaryName(e){return this.diaryNameManager.hasDiaryName(e)}constructor(e,t){this.diaryNameManager=e,this.nameGenerator=t}}eC=(0,O.Cg)([(0,s._G)(),(0,O.Qj)(0,(0,s.WQ)("IDiaryNameManager")),(0,O.Qj)(1,(0,s.WQ)("IUniqueDiaryNameGenerator")),(0,O.Sn)("design:type",Function),(0,O.Sn)("design:paramtypes",["undefined"==typeof IDiaryNameManager?Object:IDiaryNameManager,"undefined"==typeof IUniqueDiaryNameGenerator?Object:IUniqueDiaryNameGenerator])],eC),s.kL.register("UsePreviousDayDiaryEntryFactory",{useFactory:e=>e.resolve("IDiaryEntryFactory").createUsePreviousDay}),s.kL.register("DIARY_ENTRIES_CONTAINING_FIRST_DAY",{useFactory:e=>{let t=e.resolve("IDiaryEntry");return new Map().set(1,t)}}),s.kL.register("NewDiaryEntriesFactory",{useFactory:()=>()=>s.kL.resolve("DIARY_ENTRIES_CONTAINING_FIRST_DAY")}),s.kL.register("IDiary",{useClass:H}),s.kL.register("IDiaryFactory",{useClass:B}),s.kL.register("IDiaryEntry",{useClass:T}),s.kL.register("FIRST_DAY",{useValue:1}),s.kL.register("DEFAULT_TITLE",{useValue:String(s.kL.resolve("FIRST_DAY"))+Q.DEFAULT_DAY_MODIFIER}),s.kL.register("HOW_TO_USE_TEXT_URL",{useValue:Q.HOW_TO_USE_TEXT_URL}),s.kL.register("HOW_TO_USE_KEY",{useValue:Q.HOW_TO_USE_KEY}),s.kL.register("EMPTY_STRING",{useValue:""}),s.kL.register("UNDEFINED",{useFactory:()=>void 0}),s.kL.register("IDiaryEntryFactory",{useClass:$}),s.kL.register("UseExistingDataDiaryEntryFactory",{useFactory:e=>e.resolve("IDiaryEntryFactory").createUseExistingData}),s.kL.register("StorageKeyFactory",{useFactory:e=>()=>e.resolve("STORAGE_KEY")}),s.kL.register("IDiarySettings",{useClass:J}),s.kL.register("DIARY_NAME",{useValue:Q.DEFAULT_DIARY_NAME}),s.kL.register("DAY_INTERVAL",{useValue:Q.DEFAULT_DAY_INTERVAL}),s.kL.register("STORAGE_KEY",{useFactory:()=>crypto.randomUUID()}),s.kL.register("VERSION",{useValue:Q.CURRENT_VERSION}),s.kL.register("IDiarySettingsFactory",{useClass:q}),s.kL.register("DefaultSettingsFactory",{useFactory:e=>()=>e.resolve("IDiarySettings")}),s.kL.register("IDayModifier",{useClass:V}),s.kL.register("DAY_MODIFIER",{useValue:Q.DEFAULT_DAY_MODIFIER}),s.kL.register("CYCLE_LENGTH",{useValue:Q.DEFAULT_CYCLE_LENGTH}),s.kL.register("UseExistingDataDayModifierFactory",{useFactory:()=>function(e,t){for(var r=arguments.length,i=Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];return new V(e,t,...i)}}),s.kL.registerSingleton("IStorageService",z),s.kL.register("IsStorageAvailableFunc",{useValue:function(e){try{let t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(t){return t instanceof DOMException&&("QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&e&&0!==e.length}}}),s.kL.registerSingleton("IDiaryService",X),s.kL.registerSingleton("IDiaryNameManager",er),s.kL.registerSingleton("IDiaryDataMigrator",ei),s.kL.registerSingleton("IUniqueDiaryNameGenerator",ea),s.kL.registerSingleton("ICurrentDiaryManager",es),s.kL.registerSingleton("IDiaryImport",en),s.kL.registerSingleton("IDiaryExport",eo),s.kL.registerSingleton("IDiarySave",ec),s.kL.registerSingleton("IDiaryLoad",ey),s.kL.registerSingleton("ICurrentDiaryAccessor",el),s.kL.registerSingleton("IDiaryNameService",eC),s.kL.registerSingleton("ICreateDiary",ed),s.kL.registerSingleton("IDeleteDiary",eu),s.kL.registerSingleton("IDiaryImporter",eg),s.kL.registerSingleton("IDiaryExporter",eh),s.kL.registerSingleton("IDiarySaveHandler",em),s.kL.registerSingleton("IDiaryLoadHandler",eD),s.kL.registerSingleton("ICurrentDiaryEntryAccessor",ep),s.kL.registerSingleton("IChangeCurrentDiaryEntry",ev),s.kL.registerSingleton("IDeleteDiaryEntry",eS),s.kL.registerSingleton("IEditDiarySettings",ef),s.kL.registerSingleton("IEditDiaryEntry",eE),s.kL.register("CompressDiary",{useValue:function(e){let t=JSON.stringify(e);return(0,ex.compressToEncodedURIComponent)(t)}}),s.kL.register("IDiaryDecompressor",{useClass:eb});let eI=()=>{let[e,t]=(0,a.useState)(!1),r=(0,a.useCallback)(async()=>{let e=s.kL.resolve("HOW_TO_USE_TEXT_URL"),r=await fetch(e);if(!r.ok)throw s.kL.resolve("ICreateDiary").createDefaultDiary(),t(!0),Error("使い方の読み込みに失敗しました:"+e);let i=await r.text();s.kL.resolve("IDiaryImporter").importText(i),t(!0)},[]);return{isRead:e,useReadHowToUse:(0,a.useCallback)(async()=>{let e=s.kL.resolve("IDiaryLoadHandler");try{await Promise.resolve(e.load(s.kL.resolve("HOW_TO_USE_KEY"))),t(!0)}catch(e){await r()}},[r]),fetchHowToUse:r}},eN=e=>{let{children:t}=e,[r,n]=(0,a.useState)(!1),{isRead:o,useReadHowToUse:c}=eI();return((0,a.useEffect)(()=>{!r&&o&&n(!0)},[o]),(0,a.useEffect)(()=>{if(s.kL.register("LocalStorage",{useValue:window.localStorage}),s.kL.resolve("IDiaryDataMigrator").migrate(),""!==s.kL.resolve("ICurrentDiaryManager").getCurrentDiaryKey()){n(!0);return}try{c()}catch(e){console.error(e)}},[]),r)?(0,i.jsx)(i.Fragment,{children:t}):(0,i.jsx)("div",{children:"Loading..."})};var ej=r(3568);let eA=()=>{let{refreshAll:e}=y(),{moveToLatest:t}=D();return{refreshCurrentDiary:()=>{e(),t()}}},eL=()=>{let[e,t]=(0,a.useState)(),[r,i]=(0,a.useState)(""),{refreshCurrentDiary:n}=eA();return(0,a.useEffect)(()=>{t(s.kL.resolve("ICreateDiary"))},[]),{newDiaryName:r,setNewDiaryName:i,createNewDiary:()=>{if(void 0===e||""===r)return;let t=e.create(r);n(),ej.Ay.success(t.name+"を新規作成しました"),i("")}}},ek="border border-gray-400 p-2 rounded-lg shadow-md bg-gray-100 hover:bg-gray-200 active:shadow-none",e_="border border-gray-600 p-2 rounded-lg shadow-md bg-gray-800 hover:bg-gray-700 active:shadow-none",ew="bg-gray-300 border-gray-600",eM="bg-gray-600 border-gray-200";var eF=r(4502);let eO=e=>{let{children:t}=e,{isDarkMode:r}=v(),{go:s,shortcutRegister:n}=ez();return(0,a.useEffect)(()=>{if(void 0!==s&&void 0!==n)return n(e=>{"Escape"===e.key&&s.home()})},[s,n]),(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50",onClick:s.home,children:(0,i.jsx)(eF.P.div,{className:"p-6 rounded-lg shadow-lg max-w-lg w-full ".concat(r?"bg-gray-700 text-white":"bg-gray-200"," "),onClick:e=>e.stopPropagation(),initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.2},children:t})})},eQ=()=>{let{newDiaryName:e,setNewDiaryName:t,createNewDiary:r}=eL(),{isDarkMode:s}=v(),{go:n,shortcutRegister:o}=ez(),[c,y]=(0,a.useState)(!1),l=(0,a.useRef)(null);(0,a.useEffect)(()=>{setTimeout(()=>{var e;return null===(e=l.current)||void 0===e?void 0:e.focus()},0)},[]);let d=(0,a.useCallback)(()=>{r(),""!==e&&n.load()},[r,n]);return(0,a.useEffect)(()=>o(e=>{"Enter"!==e.key||c||l.current!==document.activeElement||(e.preventDefault(),d()),"Backspace"===e.key&&l.current!==document.activeElement&&n.load()}),[n,o,d]),(0,i.jsx)(eO,{children:(0,i.jsxs)("div",{className:"modal ".concat(s?"dark-mode":""),children:[(0,i.jsx)("h2",{className:"text-xl font-bold mb-4",children:"新規作成"}),(0,i.jsx)("div",{className:" mp-4 flex flex-col gap-2 items-start w-full",children:(0,i.jsx)("input",{type:"text",ref:l,className:"p-2 w-full ".concat(s?eM:ew),placeholder:"新しい日記の名前",value:e,onChange:e=>t(e.target.value),onCompositionStart:()=>y(!0),onCompositionEnd:()=>y(!1)})}),(0,i.jsxs)("div",{className:"gap-2 flex justify-start mt-4 w-full",children:[(0,i.jsx)("button",{className:"p-4 pxa-4 py-2 rounded shadow-md active:shadow-none ".concat(s?"border-gray-600 bg-gray-800 hover:bg-gray-700":"border-gray-400 bg-gray-100 hover:bg-gray-200"),onClick:d,children:"作成"}),(0,i.jsx)("div",{className:"flex-1 min-h-0"}),(0,i.jsx)("button",{className:"px-4 py-2 rounded shadow-md active:shadow-none ".concat(s?"border-gray-600 bg-gray-800 hover:bg-gray-700":"border-gray-400 bg-gray-100 hover:bg-gray-200"),onClick:n.load,children:"戻る"})]})]})})},eT=()=>{let[e,t]=(0,a.useState)(),{useReadHowToUse:r}=eI(),{refreshCurrentDiary:i}=eA(),{selectCurrentDiary:n}=F();return(0,a.useEffect)(()=>{t(s.kL.resolve("IDeleteDiary"))},[]),{deleteDiary:(0,a.useCallback)(async t=>{void 0!==e&&(e.delete(t)||(await r(),e.delete(t)),i(),n())},[e,r,i,n])}},eR=()=>{let{selectedOption:e}=F(),{deleteDiary:t}=eT(),{getDiaryName:r}=E(),{isDarkMode:s}=v(),{go:n,shortcutRegister:o}=ez(),c=(0,a.useCallback)(()=>{t(e),n.load()},[t,e]);return(0,a.useEffect)(()=>o(e=>{("Enter"===e.key||"Delete"===e.key)&&document.activeElement===document.body&&c(),"Backspace"===e.key&&n.load()}),[c]),(0,i.jsx)(eO,{children:(0,i.jsxs)("div",{className:"modal ".concat(s?"dark-mode":""),children:[(0,i.jsx)("h2",{className:"text-xl font-bold mb-4",children:"削除"}),(0,i.jsxs)("div",{className:" mp-4 flex flex-col gap-2 items-start w-full",children:[(0,i.jsxs)("p",{children:[r(e),"を削除しますか？"]}),(0,i.jsx)("p",{children:"※この操作は元に戻せません。"})]}),(0,i.jsxs)("div",{className:"gap-2 flex justify-start mt-4 w-full",children:[(0,i.jsx)("button",{className:"px-4 py-2 shadow-md active:shadow-none bg-red-500 text-white rounded hover:bg-red-600",onClick:c,children:"削除"}),(0,i.jsx)("div",{className:"flex-1 min-h-0"}),(0,i.jsx)("button",{className:"p-4 pxa-4 py-2 rounded shadow-md active:shadow-none ".concat(s?"border-gray-600 bg-gray-800 hover:bg-gray-700":"border-gray-400 bg-gray-100 hover:bg-gray-200"),onClick:n.load,children:"戻る"})]})]})})},eU=()=>{let[e,t]=(0,a.useState)(""),[r,i]=(0,a.useState)(),n="ファイルの出力に失敗しました",o="コピーに失敗しました";return(0,a.useEffect)(()=>{i(s.kL.resolve("IDiaryExporter"))},[]),{exportText:e,refreshExportText:()=>{if(void 0===r)return;let i=r.exportText();i!==e&&t(i)},handleCopy:async()=>{if(void 0===r){ej.Ay.error(o);return}try{let e=r.exportText();await navigator.clipboard.writeText(e),ej.Ay.success("クリップボードにコピーしました！")}catch(e){throw ej.Ay.error(o),e}},handleDownload:()=>{if(void 0===r){ej.Ay.error(n);return}try{let{data:e,fileName:t}=r.exportFile(),i=URL.createObjectURL(e),a=document.createElement("a");[a.href,a.download]=[i,t],a.click(),URL.revokeObjectURL(i)}catch(e){throw ej.Ay.error(n),e}}}},eW=()=>{let{exportText:e,refreshExportText:t,handleCopy:r,handleDownload:s}=eU(),{isDarkMode:n}=v(),{shortcutRegister:o}=ez();return t(),(0,a.useEffect)(()=>o(e=>{e.ctrlKey&&("c"===e.key&&(e.preventDefault(),r()),"e"===e.key&&(e.preventDefault(),s()))}),[e]),(0,i.jsxs)(eO,{children:[(0,i.jsx)("h2",{className:"text-xl font-bold mb-4",children:"エクスポート"}),(0,i.jsx)("textarea",{readOnly:!0,className:"w-full h-64 font-mono p-2 border border-gray-300 rounded resize-none ".concat(n?"bg-gray-600 border-gray-200":"bg-gray-300 border-gray-600"),value:e}),(0,i.jsxs)("div",{className:"gap-2 flex justify-start mt-4",children:[(0,i.jsx)("button",{className:"px-4 py-2 rounded shadow-md active:shadow-none ".concat(n?"border-gray-600 bg-gray-800 hover:bg-gray-700":"border-gray-400 bg-gray-100 hover:bg-gray-200"),onClick:r,children:"コピー"}),(0,i.jsx)("button",{className:"px-4 py-2 shadow-md active:shadow-none bg-blue-500 text-white rounded hover:bg-blue-600",onClick:s,children:"ファイル出力"})]})]})},eY=()=>{let[e,t]=(0,a.useState)(),{refreshCurrentDiary:r}=eA();(0,a.useEffect)(()=>{t(s.kL.resolve("IDiaryImporter"))},[]);let i=async(e,t)=>{try{await e(),r(),ej.Ay.success("".concat(t,"の読み込みに成功しました"))}catch(e){ej.Ay.error("".concat(t,"の読み込みに失敗しました"))}};return{importFromText:t=>{""!==t&&void 0!==e&&i(()=>e.importText(t),"テキスト")},importFromFile:t=>{void 0!==t&&void 0!==e&&i(()=>e.importFile(t),"ファイル")}}},eG=()=>{let[e,t]=(0,a.useState)(""),{importFromFile:r,importFromText:s}=eY(),{isDarkMode:n}=v(),{go:o,shortcutRegister:c}=ez(),y=(0,a.useRef)(null),l=(0,a.useCallback)(async()=>{await s(e),o.home()},[s,o]),d=async e=>{var t;await r(null===(t=e.target.files)||void 0===t?void 0:t[0]),o.home()};return(0,a.useEffect)(()=>c(async e=>{e.ctrlKey&&"v"===e.key&&document.activeElement!==y.current&&(e.preventDefault(),t(await navigator.clipboard.readText())),"Enter"===e.key&&l()}),[t,l,c]),(0,i.jsxs)(eO,{children:[(0,i.jsx)("h2",{className:"text-xl font-bold mb-4",children:"インポート"}),(0,i.jsx)("textarea",{ref:y,className:"w-full h-64 font-mono p-2 border border-gray-300 rounded resize-none ".concat(n?"bg-gray-600 border-gray-200":"bg-gray-300 border-gray-600"),onChange:e=>t(e.target.value),value:e}),(0,i.jsxs)("div",{className:"gap-2 flex justify-start mt-4",children:[(0,i.jsx)("button",{className:"px-4 py-2 rounded shadow-md active:shadow-none ".concat(n?"border-gray-600 bg-gray-800 hover:bg-gray-700":"border-gray-400 bg-gray-100 hover:bg-gray-200"),onClick:l,children:"インポート"}),(0,i.jsx)("input",{type:"file",accept:".txt",onChange:d,className:"hidden",id:"file-input"}),(0,i.jsx)("label",{htmlFor:"file-input",className:"px-4 py-2 shadow-md active:shadow-none bg-blue-500 text-white rounded hover:bg-blue-600",children:"ファイル読み込み"})]})]})},eK=()=>{let[e,t]=(0,a.useState)(),{refreshCurrentDiary:r}=eA();return(0,a.useEffect)(()=>{t(s.kL.resolve("IDiaryLoadHandler"))},[]),{load:async t=>{if(void 0!==e)try{e.load(t),r(),ej.Ay.success("ロードしました")}catch(e){ej.Ay.error("日記が存在しません")}}}},eP=()=>{let{diaryNames:e}=E(),{selectedOption:t,setSelectedOption:r,selectCurrentDiary:s}=F(),{refreshDiary:n}=y(),{load:o}=eK(),{isDarkMode:c}=v(),{go:l,shortcutRegister:d}=ez(),u=(0,a.useRef)(null);return(0,a.useEffect)(()=>{var e;s(),n(),null===(e=u.current)||void 0===e||e.focus()},[s,n,u]),(0,a.useEffect)(()=>d(e=>{"Enter"===e.key&&(document.activeElement===u.current||document.activeElement===document.body)&&o(t),(e.ctrlKey&&"d"===e.key||"Delete"===e.key)&&(e.preventDefault(),l.delete())}),[t,o,l,d]),(0,i.jsxs)(eO,{children:[(0,i.jsx)("h2",{className:"text-xl font-bold mb-4",children:"ロード"}),(0,i.jsx)("select",{ref:u,className:"w-full p-2 ".concat(c?"bg-gray-600":"bg-gray-300"),value:t,onChange:e=>{r(e.target.value)},children:e.map(e=>(0,i.jsx)("option",{value:e[0],children:e[1]},e[0]))}),(0,i.jsxs)("div",{className:"gap-2 flex justify-start mt-4",children:[(0,i.jsx)("button",{className:"px-4 py-2 rounded shadow-md active:shadow-none ".concat(c?"border-gray-600 bg-gray-800 hover:bg-gray-700":"border-gray-400 bg-gray-100 hover:bg-gray-200"),onClick:()=>{o(t)},children:"ロード"}),(0,i.jsx)("button",{className:"px-4 py-2 rounded shadow-md active:shadow-none ".concat(c?"border-gray-600 bg-gray-800 hover:bg-gray-700":"border-gray-400 bg-gray-100 hover:bg-gray-200"),onClick:l.create,children:"新規作成"}),(0,i.jsx)("div",{className:"flex-1 min-h-0"}),(0,i.jsx)("button",{className:"px-4 py-2 rounded shadow-md active:shadow-none ".concat(c?"border-gray-600 bg-gray-800 hover:bg-gray-700":"border-gray-400 bg-gray-100 hover:bg-gray-200"),onClick:l.delete,children:"削除"})]})]})};var eH=function(e){return e[e.Home=0]="Home",e[e.Export=1]="Export",e[e.Import=2]="Import",e[e.Load=3]="Load",e[e.Delete=4]="Delete",e[e.Create=5]="Create",e}(eH||{});let eV=(0,a.createContext)(null),eJ=e=>{let{children:t}=e,[r,s]=(0,a.useState)(0),n=(0,a.useRef)([]);(0,a.useEffect)(()=>{let e=e=>{n.current.forEach(t=>t(e,o))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[r]);let o={home:()=>0===r,export:()=>1===r,import:()=>2===r,load:()=>3===r,create:()=>5===r,delete:()=>4===r};return(0,i.jsxs)(eV.Provider,{value:{go:{home:()=>s(0),export:()=>s(1),import:()=>s(2),load:()=>s(3),create:()=>s(5),delete:()=>s(4)},shortcutRegister:e=>(n.current.push(e),()=>{n.current=n.current.filter(t=>t!==e)})},children:[t,1===r&&(0,i.jsx)(eW,{}),2===r&&(0,i.jsx)(eG,{}),5===r&&(0,i.jsx)(eQ,{}),4===r&&(0,i.jsx)(eR,{}),3===r&&(0,i.jsx)(eP,{})]})},ez=()=>{let e=(0,a.useContext)(eV);if(null===e)throw Error("useMoveModalContext must be used within a MoveModalProvider");return e},eB=e=>{let{children:t}=e;return(0,i.jsx)(eN,{children:(0,i.jsx)(c,{children:(0,i.jsx)(f,{children:(0,i.jsx)(S,{children:(0,i.jsx)(M,{children:(0,i.jsx)(d,{children:(0,i.jsx)(A,{children:(0,i.jsx)(h,{children:(0,i.jsx)(eJ,{children:t})})})})})})})})})},e$=e=>{let{text:t,day:r,index:s,onRemove:n,isDarkMode:o}=e,[c,y]=(0,a.useState)(!1),{moveByDate:l}=D(),d=()=>{c?n():(y(!0),setTimeout(()=>{y(!1)},300))};return(0,i.jsxs)("li",{className:"flex justify-between items-center p-2 border rounded-md shadow-md transition-colors\n         ".concat(o?s%2==0?"bg-gray-700":"bg-gray-800":s%2==0?"bg-gray-100":"bg-gray-200"),onClick:()=>{l(r)},children:[(0,i.jsx)("span",{className:"w-full block truncate",title:t,children:t}),(0,i.jsx)("button",{onClick:e=>{e.stopPropagation(),d()},className:"\n          'ml-2 p-1 w-6 h-6 flex items-center justify-center border rounded-full min-h-0\n          ".concat(c?"bg-red-500 hover:bg-red-600":o?"bg-gray-300 hover:bg-gray-500 text-black":"bg-gray-400 hover:bg-gray-300"),children:"\xd7"})]})},eq=()=>{let{diaryEntries:e,deleteDiaryEntry:t}=u(),{isDarkMode:r}=v();return(0,i.jsx)("ol",{className:"h-full overflow-auto box-border m-0 pb-0",children:e.map((e,a)=>(0,i.jsx)(e$,{text:e.title,day:e.day,index:a,onRemove:()=>t(e.day),isDarkMode:r},a))})},eX=async()=>{try{s.kL.resolve("IDiarySaveHandler").save(),ej.Ay.success("セーブしました")}catch(e){throw ej.Ay.error("セーブできませんでした"),e}},eZ=()=>{let{isDarkMode:e,setDarkMode:t}=v(),{go:r}=ez();return(0,i.jsxs)("div",{className:"w-[12.5%] p-2 overflow-hidden flex flex-col h-[100%] min-w-[260px] ".concat(e?"bg-gray-700":"bg-gray-200"),children:[(0,i.jsx)("div",{className:"flex gap-2 mb-4 overflow-hidden min-h-0",children:(0,i.jsx)("button",{className:"border p-2 whitespace-nowrap ".concat(e?e_:ek),onClick:()=>t(!e),children:e?"ライトモード":"ダークモード"})}),(0,i.jsx)("div",{className:"min-h-0 h-[70%] overflow-hidden",children:(0,i.jsx)(eq,{})}),(0,i.jsx)("div",{className:"flex-1"}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-2 flex-none min-h-0",children:[(0,i.jsx)("button",{className:"overflow-hidden ".concat(e?e_:ek),onClick:eX,children:"セーブ"}),(0,i.jsx)("button",{className:"overflow-y-clip overflow-x-clip ".concat(e?e_:ek),onClick:r.export,children:"エクスポート"}),(0,i.jsx)("button",{className:"overflow-y-clip overflow-x-clip ".concat(e?e_:ek),onClick:r.load,children:"ロード"}),(0,i.jsx)("button",{className:"overflow-y-clip overflow-x-clip ".concat(e?e_:ek),onClick:r.import,children:"インポート"})]})]})},e0=()=>{let[e,t]=(0,a.useState)(!1);return{isOpen:e,setIsOpen:t}},e1=()=>{let[e,t]=(0,a.useState)(""),[r,i]=(0,a.useState)(),[n,o]=(0,a.useState)(),{entryRefresherRegister:c}=y();(0,a.useEffect)(()=>{o(s.kL.resolve("IEditDiarySettings"));let e=s.kL.resolve("ICurrentDiaryAccessor");i(e);let r=()=>{t(e.getCurrentDiary().getSettings().getDiaryName())};return r(),c(r)},[c]);let l=(0,a.useCallback)(e=>{void 0!==n&&void 0!==r&&(n.editDiaryName(e),t(r.getCurrentDiary().getSettings().getDiaryName()))},[n,t]);return{diaryName:e,setDiaryName:t,editDiaryName:l}},e2=()=>{let{isDarkMode:e}=v(),{diaryName:t,setDiaryName:r,editDiaryName:a}=e1();return(0,i.jsxs)("div",{className:"min-w-[200px]",children:[(0,i.jsx)("h3",{className:"text-center",children:"日記の名前"}),(0,i.jsx)("input",{type:"text",className:"border p-2 w-full ".concat(e?eM:ew),value:t,onChange:e=>r(e.target.value),onBlur:e=>a(e.target.value)})]})},e4=()=>{let[e,t]=(0,a.useState)(""),[r,i]=(0,a.useState)(),{entryRefresherRegister:n}=y();return(0,a.useEffect)(()=>{i(s.kL.resolve("IEditDiarySettings"));let e=s.kL.resolve("ICurrentDiaryAccessor"),r=()=>{t(e.getCurrentDiary().getSettings().getModifier())};return r(),n(r)},[n]),{modifier:e,editModifier:(0,a.useCallback)(e=>{void 0!==r&&(r.editModifier(e),t(e))},[r])}},e5=()=>{let{isDarkMode:e}=v(),{modifier:t,editModifier:r}=e4();return(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-center",children:"日付の単位"}),(0,i.jsx)("input",{type:"text",className:"border w-full p-2 ".concat(e?eM:ew),value:t,onChange:e=>{r(e.target.value)}})]})},e3=()=>{let[e,t]=(0,a.useState)(15),[r,i]=(0,a.useState)(15),[n,o]=(0,a.useState)(),{entryRefresherRegister:c}=y();(0,a.useEffect)(()=>{o(s.kL.resolve("IEditDiarySettings"));let e=s.kL.resolve("ICurrentDiaryAccessor"),r=()=>{let r=e.getCurrentDiary().getSettings().getCycleLength();t(r),i(r)};return r(),c(r)},[c]);let l=(0,a.useCallback)(e=>{let t=Number(e);!isNaN(t)&&!(t<0)&&i(t)},[i]),d=(0,a.useCallback)(e=>{!isNaN(e)&&!(e<1)&&!(e>50)&&void 0!==n&&(t(e),i(e),n.editCycleLength(e))},[n]),u=(0,a.useCallback)(t=>{if(isNaN(t)||t<1||t>50){i(e);return}d(t)},[e,d]);return{cycleLength:e,cycleLengthStr:r,onChangeCycleLength:d,onChangeCycleLengthStr:l,onCycleLengthBlur:u}},e6=()=>{let[e,t]=(0,a.useState)(),[r,i]=(0,a.useState)([,,,,].fill("")),{entryRefresherRegister:n}=y();return(0,a.useEffect)(()=>{t(s.kL.resolve("IEditDiarySettings"));let e=s.kL.resolve("ICurrentDiaryAccessor"),a=()=>{i(r.map((t,r)=>e.getCurrentDiary().getSettings().getModifierUnit(r)))};return a(),n(a)},[n]),{modifierUnits:r,editModifierCycle:(0,a.useCallback)((t,r)=>{void 0!==e&&(e.editModifierCycle(t,r),i(e=>e.with(t,r)))},[e])}},e8=()=>{let{isDarkMode:e}=v(),{modifierUnits:t,editModifierCycle:r}=e6(),{cycleLength:a,cycleLengthStr:s,onChangeCycleLength:n,onChangeCycleLengthStr:o,onCycleLengthBlur:c}=e3();return(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex items-center justify-center gap-4",children:[(0,i.jsx)("h3",{className:"min-w-[100px]",children:"周期単位"}),(0,i.jsx)("p",{className:"text-right min-w-[180px]",children:"$N:総日数　$Y:年　$D:日　$C:周期的な単位"})]}),(0,i.jsx)("div",{className:"p-4 grid grid-cols-4 gap-2",children:[void 0,void 0,void 0,void 0].map((a,s)=>(0,i.jsxs)("div",{className:"flex items-left gap-2",children:[(0,i.jsxs)("p",{children:[s+1,"."]},"".concat(s)),(0,i.jsx)("input",{type:"text",className:"border p-1 text-right w-4/5 ".concat(e?eM:ew),value:t[s],onChange:e=>{r(s,e.target.value)}},"label-".concat(s))]},s))}),(0,i.jsxs)("div",{className:"flex items-center justify-center gap-4",children:[(0,i.jsx)("input",{type:"range",list:"cycleLengthTickMarks",min:1,max:50,value:a,onChange:e=>{n(Number(e.target.value))}}),(0,i.jsxs)("datalist",{id:"cycleLengthTickMarks",children:[Array.from({length:10},(e,t)=>(0,i.jsx)("option",{value:t+1,label:"".concat(t+1)},t)),Array.from({length:10},(e,t)=>(0,i.jsx)("option",{value:10+5*t,label:"".concat(10+5*t)},t+10))]}),(0,i.jsxs)("div",{className:"flex justify-center",children:[(0,i.jsx)("input",{type:"text",className:"border p-2 text-right w-[10ch] ".concat(e?eM:ew),value:s,onChange:e=>{o(e.target.value)},onBlur:e=>{c(Number(e.target.value))}}),(0,i.jsx)("p",{className:"p-2 whitespace-nowrap",children:"周期"})]})]})]})},e7=()=>{let[e,t]=(0,a.useState)(1),[r,i]=(0,a.useState)(1),[n,o]=(0,a.useState)(),{entryRefresherRegister:c}=y();(0,a.useEffect)(()=>{o(s.kL.resolve("IEditDiarySettings"));let e=s.kL.resolve("ICurrentDiaryAccessor"),r=()=>{let r=e.getCurrentDiary().getSettings().getDayInterval();t(r),i(r)};return r(),c(r)},[c]);let l=(0,a.useCallback)(r=>{if(isNaN(r)||r<1||r>100||void 0===n){i(e);return}n.editDayInterval(r),t(r)},[e,n,i,t]),d=(0,a.useCallback)(e=>{let t=Number(e);!isNaN(t)&&!(t<0)&&i(t)},[i]);return{dayInterval:e,dayIntervalStr:r,onChangeDayInterval:(0,a.useCallback)(e=>{!isNaN(e)&&!(e<1)&&!(e>100)&&void 0!==n&&(t(e),i(e),n.editDayInterval(e))},[t,i,n]),onChangeDayIntervalStr:d,onBlurDayInterval:l}},e9=()=>{let{isDarkMode:e}=v(),{dayInterval:t,dayIntervalStr:r,onChangeDayInterval:a,onChangeDayIntervalStr:s,onBlurDayInterval:n}=e7();return(0,i.jsxs)("div",{className:"p-1r",children:[(0,i.jsx)("h3",{className:"text-center",children:"日記の間隔"}),(0,i.jsx)("input",{type:"range",list:"dayIntervalTickMarks",min:1,max:100,value:t,onChange:e=>{a(Number(e.target.value))},className:"border p-2 text-center w-full ".concat(e?"bg-gray-700 border-gray-500":"bg-gray-200 border-gray-400 text-black")}),(0,i.jsxs)("datalist",{id:"dayIntervalTickMarks",children:[Array.from({length:15},(e,t)=>(0,i.jsx)("option",{value:t+1,label:"".concat(t+1)},t)),Array.from({length:18},(e,t)=>(0,i.jsx)("option",{value:15+5*t,label:"".concat(15+5*t)},t+15))]}),(0,i.jsxs)("div",{className:"flex justify-center",children:[(0,i.jsx)("input",{type:"text",className:"border p-2 text-right w-[10ch] ".concat(e?eM:ew),value:r,onChange:e=>{s(e.target.value)},onBlur:e=>{n(Number(e.target.value))},onFocus:e=>{e.target.select()}}),(0,i.jsx)("p",{className:"p-2",children:"毎"})]})]})},te=()=>{let{isDarkMode:e}=v(),{isOpen:t,setIsOpen:r}=e0(),[s,n]=(0,a.useState)(300),[o,c]=(0,a.useState)(()=>window.innerWidth<=1600);return(0,a.useEffect)(()=>{let e=window.matchMedia("(max-width: ".concat(1600,"px)")),t=e=>{c(e.matches),n(e.matches?300:150)};return c(e.matches),n(e.matches?300:150),e.addEventListener("change",t),()=>{e.removeEventListener("change",t)}},[]),(0,i.jsxs)("div",{className:"gap-2 overflow-hidden transition-[height] duration-300 ".concat(t?"":"p-4 ","\n            ").concat(e?"bg-gray-700":"bg-gray-200"),style:{height:t?"0px":"".concat(s,"px"),display:"grid",gridTemplateColumns:o?"repeat(2, 1fr)":"auto 300px 250px 500px"},children:[(0,i.jsx)("button",{className:"absolute transition-[bottom] duration-300 w-32 h-8 p-0 bg-gray-400 dark:bg-gray-600 shadow-md text-[0.7rem] flex items-end justify-center",style:{bottom:t?"15px":"".concat(s+15,"px"),clipPath:"polygon(10% 50%, 90% 50%, 100% 100%, 0% 100%)"},onClick:()=>r(!t),children:t?"開く":"閉じる"}),(0,i.jsx)(e2,{}),(0,i.jsx)(e9,{}),(0,i.jsx)(e5,{}),(0,i.jsx)(e8,{})]})},tt=()=>{let{isDarkMode:e}=v(),{title:t,updateTitle:r}=L(),{clearEntry:a}=_();return(0,i.jsxs)("div",{className:"translate-y-1 h-16 mb-2 flex justify-end items-center p-2 gap-2",children:[(0,i.jsx)("input",{type:"text",className:"p-2 h-16 mb-2 flex-1 min-h-0 ".concat(e?eM:ew),value:t,onChange:e=>r(e.target.value)}),(0,i.jsx)("button",{className:"p-2 w-10 aspect-square ".concat(e?e_:ek),onClick:a,children:"\xd7"})]})},tr=()=>{let{isDarkMode:e}=v(),{content:t,updateContent:r}=k(),{shortcutRegister:s}=ez(),{onArrowMoveEntry:n}=D();return(0,a.useEffect)(()=>s((e,t)=>{n(e,t),"s"===e.key&&e.ctrlKey&&t.home()&&(e.preventDefault(),eX())}),[n]),(0,i.jsx)("div",{className:"p-2 flex-1 min-h-0",children:(0,i.jsx)("textarea",{className:"p-2 h-full w-full ".concat(e?eM:ew),value:t,onChange:e=>{r(String(e.target.value))}})})},ti=e=>{let{children:t}=e,{isDarkMode:r}=v();return(0,i.jsx)("div",{className:"flex h-screen p-4 overflow-y-clip overflow-x-clip overflow-x-scroll ".concat(r?"bg-gray-800 text-white":"bg-gray-100 text-black"),children:t})},ta=()=>(0,i.jsxs)(eB,{children:[(0,i.jsx)(ej.l$,{position:"bottom-center",reverseOrder:!1}),(0,i.jsxs)(ti,{children:[(0,i.jsx)(eZ,{}),(0,i.jsxs)("div",{className:"flex-1 flex flex-col min-h-0",children:[(0,i.jsx)(tt,{}),(0,i.jsx)(tr,{}),(0,i.jsx)(te,{})]})]})]})},4356:(e,t,r)=>{Promise.resolve().then(r.bind(r,1466))}},e=>{var t=t=>e(e.s=t);e.O(0,[895,441,684,358],()=>t(4356)),_N_E=e.O()}]);